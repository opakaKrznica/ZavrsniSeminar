@page "/Admin/orders-list"
@using Expert.WebShop.Vjezbe.models;
@inject HttpClient httpClient;
@inject NavigationManager navManager;

@*@<h3>OrdersList</h3>

<ul>
    @foreach (var item in distinctOrders)
    {
        <li>
            <h4>Narudžba šifra: @item.OrderId</h4>
            <ul>
                @foreach (var product in ordersList.Where(x => x.OrderId == item.OrderId).ToList())
                {
                    <li>
                        <p> Id proizvoda: @product.Id </p>
                        <p>Cijena: @product.PricePerProduct</p>
                        <p>Komada: @product.NumberOfItems</p>
                        <p>Ukupno: @product.TotalAmmount</p>
                    </li>
                }
            </ul>

            <p>Kupac: @item.OrderedByName</p>
        </li>

    }
</ul>*@


<div class="container-md Width ">

    <nav class="navbar indigo d-md-flex justify-content-around sticky-top">

        <h3 class="mt-3 fs-2 ">Order List</h3>

        <div class="card-text bg-secondary  border-dark border-bottom border-end border-2
                     rounded-2 text-light text-center me-2 m-2 p-4">
            <h4>Total cash:     Eur</h4>
        </div>

        <button type="button" class="btn-secondary rounded-2 m-3 p-2 " @onclick="Return">
            Home
        </button>

    </nav>

    @{
       

    }


    <section class="d-flex justify-content-center text-center bg-secondary bg-gradient">
     <div class="container">
        <ul class="list-unstyled   p-5">

            @foreach (var item in distinctOrders)
            {
                decimal GrandTotal = 0;

                <li>
                    <div class="card  text-center p-2 mt-3">
                        <p class="card-text fs-4 text-decoration-underline">Order Id: @item.OrderId</p>

                        <p class="card-text fs-4">Name : @item.OrderedByName</p>
                        <p class="card-text fs-4">Adress : @item.OrderByAdress</p>
                        <p class="card-text fs-4">Mail : @item.OrderedByEmail</p>

                    </div>
                    <ul>

                        @foreach (var product in ordersList.Where(x => x.OrderId == item.OrderId).ToList())
                        {
                           // @foreach (var proizvod in proizvodi.Where(x => x.Id == item.ProductId).ToList())
                           // {

                            //    <h3 class="card-title bg-info text-dark rounded-2 p-2">
                            //        Product name : @proizvod.ProductName
                            //    </h3>
                          //  }


                            <li class="list-unstyled  p-1">

                                <div class="card  text-center p-2 mt-3">

                                    <div class="card-body">
                                                                              
                                        <br /><br />
                                        <p class="card-text fs-4">
                                            Price per product : @product.PricePerProduct Eur
                                        </p>
                                        <br />
                                        <p class="card-text fs-4">
                                            Number Of Items : @product.NumberOfItems
                                        </p>
                                        <br />
                                        <p class="card-text fs-4">
                                            Total Ammount : @product.TotalAmmount Eur
                                        </p>
                                        <br />

                                        @{
                                           

                                            GrandTotal = GrandTotal + product.TotalAmmount;

                                            
}
                                    </div>
                                    
                                </div>
                            </li>
                            <p class="card-text fs-4 bg-info">
                                Grand Total : @GrandTotal Eur
                            </p>
                        }
                    </ul>

                  

                </li>

            }

        </ul>
        </div>
    </section>

</div>




@code {
    List<BuyItems> ordersList = new List<BuyItems>();
    List<BuyItems> distinctOrders = new List<BuyItems>();
    List<Products> proizvodi = new List<Products>();


    protected override async Task OnInitializedAsync()
    {
        var result = await httpClient.GetAsync("https://expertshopapi.azurewebsites.net/api/ShoppingCards");

        var result2 = await httpClient.GetAsync("https://expertshopapi.azurewebsites.net/api/Products");


        if (result.IsSuccessStatusCode)
        {
            ordersList = await result.Content.ReadFromJsonAsync<List<BuyItems>>();

            distinctOrders = ordersList.DistinctBy(x => x.OrderId).ToList();

            proizvodi = await result2.Content.ReadFromJsonAsync<List<Products>>();

        }
    }

    public async Task Return()
    {
        navManager.NavigateTo("/");
    }
}

